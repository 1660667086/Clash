# ===== Core =====
mixed-port: 7890
allow-lan: true
mode: Rule
log-level: info
ipv6: true
unified-delay: true

# 可选：本地 API（给 Clash GUI 用）
external-controller: 127.0.0.1:9090

# ===== TUN (转发系统级 UDP/IPv6) =====
tun:
  enable: true
  stack: system              # 可改为 gvisor 视环境而定
  auto-route: true
  auto-detect-interface: true
  dns-hijack:
    - any:53

# ===== DNS =====
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  default-nameserver:
    - 114.114.114.114
    - 223.5.5.5
    - 8.8.8.8
    - 2001:4860:4860::8888
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
    - https://dns.google/dns-query
    - 2001:4860:4860::8844
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "localhost"

# ===== 代理节点 =====
proxies:
  - name: "SS-43.138.198.26"
    type: ss
    server: 43.138.198.26
    port: 80
    cipher: aes-256-gcm
    password: "1"
    udp: true

# ===== 代理分组 =====
proxy-groups:
  - name: "Proxy"
    type: select
    proxies:
      - "SS-43.138.198.26"
      - "DIRECT"

# ===== 规则（除本机/局域网外，一律走代理） =====
rules:
  # 本机与局域网直连，避免回环/内网被代理
  - DOMAIN-SUFFIX,local,DIRECT
  - DOMAIN-SUFFIX,lan,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - IP-CIDR,224.0.0.0/4,DIRECT,no-resolve          # 组播
  - IP-CIDR,fe80::/10,DIRECT,no-resolve             # 链路本地 IPv6
  - IP-CIDR,fc00::/7,DIRECT,no-resolve              # 私有 IPv6
  - GEOIP,PRIVATE,DIRECT                            # 其它私有/保留网段
  # 其余全部代理
  - MATCH,Proxy
